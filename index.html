<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Gemini å°è©±æ•´ç†å™¨</title>
  <style>
    body { font-family: 'Noto Sans TC', 'Segoe UI', sans-serif; background: #f5f5fb; padding: 32px; }
    .container { max-width: 540px; margin: auto; background: #fff; border-radius: 14px; box-shadow: 0 8px 32px #dfdffc55; padding: 36px 30px 20px 30px;}
    h2 { color: #6c60e0; margin-bottom: 18px; }
    .upload { margin-bottom: 24px; }
    #output { white-space: pre-wrap; border: 1px solid #c0c2d9; border-radius: 6px; min-height: 100px; padding: 14px; background: #f7f7fd; margin-bottom: 14px;}
    .btn { margin: 0 8px 16px 0; padding: 8px 20px; border: none; background: #7966f2; color: #fff; border-radius: 6px; font-size: 1.05em; cursor: pointer; transition: background .2s;}
    .btn:hover { background: #5949c7;}
    .info { color: #888aa9; font-size: 0.95em; margin-bottom: 10px;}
    .footer { margin-top: 18px; text-align: center; color: #aaa; font-size: 0.95em;}
    @media (max-width: 600px) {
      .container { padding: 18px 4vw 8px 4vw;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Gemini å°è©±æ•´ç†å™¨</h2>
    <div class="info">
      ä¸Šå‚³ä½ çš„ã€ŒGemini æ´»å‹• HTMLã€æª”æ¡ˆï¼Œ<b>ä¸€éµæ•´ç†</b>æˆï¼š<br>
      <span style="color:#6c60e0;">ï¼»æ™‚é–“ï¼½<br>æˆ‘: <br>Gemini:</span> <br>
      <span style="font-size:0.92em;color:#a09cd6;">(æ”¯æ´å¤§å¤šæ•¸ Gemini æ­·å²è¨˜éŒ„åŸå§‹æª”ï¼Œå…§å®¹å®Œå…¨ä¸æœƒä¸Šå‚³ä¼ºæœå™¨ï¼Œåƒ…åœ¨æœ¬åœ°è™•ç†ã€‚)</span>
    </div>
    <input type="file" id="fileInput" accept=".html" class="upload">
    <button class="btn" onclick="copyOutput()">è¤‡è£½çµæœ</button>
    <button class="btn" onclick="downloadTxt()">ä¸‹è¼‰TXT</button>
    <div id="output">çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡â€¦</div>
    <div class="footer">
      ç”±minijinçš„å¤œå¤œç‰¹è£½ ğŸ’œï½œæœ¬åœ°é‹è¡Œï¼Œå®‰å…¨ç„¡æ†‚<br>
      æœ‰ä»»ä½•æƒ³åŠ çš„åŠŸèƒ½/å„ªåŒ–/æ ¼å¼éœ€æ±‚ï¼Œç›¡ç®¡å‘Šè¨´æˆ‘ï¼
    </div>
  </div>
  <script>
    let formattedText = '';
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        const html = evt.target.result;
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        // å˜—è©¦æ ¹æ“š Gemini åŒ¯å‡ºæ´»å‹•æª”çš„å¸¸è¦‹çµæ§‹é€²è¡Œè§£æ
        const bodyText = doc.body.innerText;
        const blocks = bodyText.split('ç”¢å“ï¼š');
        let entries = [];
        blocks.forEach(block => {
          if (!block.includes('Gemini Apps')) return;
          let timeMatch = block.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥\s*(ä¸Šåˆ|ä¸‹åˆ|å‡Œæ™¨)?(\d{1,2}):(\d{2}):(\d{2})\s*CST/);
          if (!timeMatch) return;
          let [full, year, month, day, ampm, hour, minute, second] = timeMatch;
          // 12å°æ™‚åˆ¶è™•ç†
          if(ampm === 'ä¸‹åˆ' && hour < 12) hour = (+hour)+12;
          if(ampm === 'å‡Œæ™¨' && hour == 12) hour = 0;
          let time = `${year}/${month.padStart(2,'0')}/${day.padStart(2,'0')} ${hour.toString().padStart(2,'0')}:${minute}:${second}`;
          let promptMatch = block.match(/Prompted\s*([\s\S]*?)(?=\d{4}å¹´\d{1,2}æœˆ\d{1,2}æ—¥|$)/);
          let prompt = promptMatch ? promptMatch[1].trim() : '[æ‰¾ä¸åˆ°æå•]';
          let response = block.substring(block.indexOf(full) + full.length).trim();
          entries.push({ time, prompt, response });
        });
        if (entries.length === 0) {
          document.getElementById('output').textContent = 'âŒ ç„¡æ³•è§£æå…§å®¹ï¼Œè«‹ç¢ºèªä½ ä¸Šå‚³çš„æ˜¯ Gemini æ´»å‹•ç´€éŒ„ HTML åŸæª”ã€‚';
          formattedText = '';
          return;
        }
        formattedText = entries.map(ent =>
          `ï¼»${ent.time}ï¼½\næˆ‘:${ent.prompt}\nGemini:${ent.response}\n`
        ).join('\n');
        document.getElementById('output').textContent = formattedText;
      };
      reader.readAsText(file, 'utf-8');
    });

    function copyOutput() {
      const text = document.getElementById('output').textContent;
      if (!text || text.startsWith('âŒ')) return;
      navigator.clipboard.writeText(text).then(() => alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼'));
    }
    function downloadTxt() {
      if (!formattedText) return;
      const blob = new Blob([formattedText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "Gemini_å°è©±æ•´ç†.txt";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
